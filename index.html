<!DOCTYPE html>
<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
            crossorigin="anonymous"></script>
</head>

<body>

    <div class="container" style="margin-top: 40px;">
        <div class="row">
            <form id="customer-form">
                <div class="row align-items-start">
                    <div class="input-group col">
                        <span class="input-group-text">Customer</span>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="firstName"
                            name="firstName"
                            placeholder="First name">
                        <input 
                            type="text" 
                            class="form-control" 
                            id="lastName"
                            name="lastName"
                            placeholder="Last name">
                        <button 
                            type="submit" 
                            id="add-customer"
                            class="btn btn-primary">Save</button>
                        <button 
                            type="button"
                            id="update-customer"
                            class="btn btn-primary"
                            style="display:none;"
                            >Update</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="row" id="customer-data">
            <table class="table table-striped" id="customer-table">
                <thead>
                    <tr>
                        <th>First name</th>
                        <th>Last name</th>
                        <th></th>
                    </tr>
                    
                </thead>
                <tbody>                   
                </tbody>
            </table>
        </div>
    </div>
    



    <script>
        $(document).ready(function () {
            init();
        });

        const init = () => {
            $('#customer-form').submit(addCustomer);
            var customers = getCustomers();
            $.each(customers, (index, customer) => displayCustomer(index, customer));           
        }

        const displayCustomer = (index, customer) => {
            $('#customer-table tbody').append($(
                '<tr><td>' + customer.firstName + '</td>' + 
                '<td>' + customer.lastName + '</td>' + 
                '<td><input type="button" class="btn btn-secondary edit-customer" value="Edit" onClick=editCustomer(' + index + ')>' +
                '<input type="button" class="btn btn-secondary delete-customer" value="Delete" onClick=deleteCustomer(' + index + ')>' +
                '<input type="hidden" name="index-customer" value=' + index + '>' +
                '<input type="hidden" name="firstName" value="' + customer.firstName + '">' +
                '<input type="hidden" name="lastName" value="' + customer.lastName + '">' +
                '</td></tr>'));
            
        }

        const addCustomer = (event) => {            
            var fields = $(event.target).serializeArray();
            var customer = {};
            $.each(fields, (index, field) => {
                customer[field.name] = field.value;
            })
            var customers = getCustomers();
            customers.push(customer);
            saveCustomers(customers);
            displayCustomer(customers.length - 1, customer);
            resetForm();
            event.preventDefault();
        }


        const deleteCustomer = (index) => {
            var customers = getCustomers();
            customers.splice(index, 1)
            saveCustomers(customers);
            location.reload();
        }
        
        const editCustomer = (index) => {
            toggleButton('#add-customer');
            toggleButton('#update-customer');
            $('#firstName').val(getHiddenValueByName('firstName', event));
            $('#lastName').val(getHiddenValueByName('lastName', event));
            $('#update-customer').click({'index': index}, updateCustomer);
        }

        const updateCustomer = (event) => {
            var customers = getCustomers();
            var customer = customers[event.data.index];
            customer.firstName = $('#firstName').val();
            customer.lastName =  $('#lastName').val();
            saveCustomers(customers);
            resetForm();
            toggleButton('#add-customer');
            toggleButton('#update-customer');

            $('#customer-table tbody tr:eq(' + event.data.index + ') td:eq(0)').html(customer.firstName);
            $('#customer-table tbody tr:eq(' + event.data.index + ') td:eq(1)').html(customer.lastName);
        }

        const toggleButton = (buttonId) => {
            var button = $(buttonId);
            if (button.is(':visible'))
                button.hide();
            else
                button.show();
        }

        const getCustomers = () => {
            var customers = localStorage.getItem('customers');
            return customers === null ? [] : JSON.parse(customers);
        }

        const saveCustomers = (customers) => {
            localStorage.setItem('customers', JSON.stringify(customers));
        }
        
        const getHiddenValueByName = (name, event) => {
            return $(event.target).siblings('input:hidden[name="' + name + '"]').val();
        }

        const resetForm = () => {
            $('#customer-form').trigger('reset');
        }


    </script>
</body>

</html>